//Mandrel and Allargatore
//Pozzeto side
//Toolpath Creation for Spine


FUNCTION SPINE_POZZETO_D12_TEMPLATE(STRING $SETNAME , STRING $COMPANY , BOOL $MANDREL , BOOL $ALLARGATORE BOOL $MANUAL_ALLIGN , BOOL $SPINE_ALLIGN , STRING $WP_POZZETO) {
	//Variables
	STRING $TOOLNUMBER = ""
	STRING $NAME = ""
	REAL $SPEED = 0
	REAL $FEED = 0
	REAL $PLUNGE = 0
	STRING LIST $TOOLPATHS = {}
	EDIT TOOLPATH THICKNESS LIST UPDATE 0 NEW
	
	//List the Toolpaths
	IF $ALLARGATORE AND $MANUAL_ALLIGN {
		//SGR Procedure                Toolpath            Index  Tool
		//                              10        20        30
		//                     012345678901234567890123456789012345678
		STRING $DRILL       = "SPINE POZZETO D12 DRILL       2    T228"
		STRING $SMUSSO      = "SPINE POZZETO D12 SMUSSO      1    T806"
		$TOOLPATHS = {$DRILL , $SMUSSO}
		
		//Clear Toolpaths
		FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
			IF ENTITY_EXISTS('Toolpath' , $PATHNAME) {
				DELETE Toolpath $PATHNAME NOQUIBBLE
			}
		}
		
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D12\SPINE POZZETO D12 SGR.ptf"
	} ELSE {
		
		//FINtf Procedure              Toolpath            Index  Tool
		//                              10        20        30
		//                     012345678901234567890123456789012345678
		STRING $DRILL       = "SPINE POZZETO D12 DRILL       2    T238"
		STRING $PREFIN      = "SPINE POZZETO D12 PREFIN      2    T966"
		STRING $SMUSSO      = "SPINE POZZETO D12 SMUSSO      1    T806"
		STRING $SEMIFIN     = "SPINE POZZETO D12 SEMIFIN     2    T973"
		STRING $FIN         = "SPINE POZZETO D12 FIN         2    T973"
		$TOOLPATHS = {$DRILL , $PREFIN , $SMUSSO , $SEMIFIN , $FIN}
		
		//Clear Toolpaths
		FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
			IF ENTITY_EXISTS('Toolpath' , $PATHNAME) {
				DELETE Toolpath $PATHNAME NOQUIBBLE
			}
		}
		
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D12\SPINE POZZETO D12 FINTF.ptf"
	}
	
	//Select Solid to ignore it
	BLANK UNDO
	EDIT LEVEL "264" SELECT ALL
	
	//Build the toolpaths
	FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
		INT $INDEX = SUBSTRING($PACKET , 30 , 1)
		STRING $TOOLNUMBER = SUBSTRING($PACKET , 35 , 4)
		EDIT TOOLPATH THICKNESS LIST UPDATE 0 NEW
		
		//Drill Toolpath
		ACTIVATE Toolpath $PATHNAME
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Select Component
		EDIT DRILL TOP_INDEX $INDEX
		EDIT DRILL COMP_INDEX $INDEX
		//Tool
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH THICKNESS LIST UPDATE 0 NEW
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH $PATHNAME CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
	}		
	//Deselect Solid
	BLANK UNDO
}

FUNCTION SPINE_POZZETO_D16_TEMPLATE(STRING $SETNAME , STRING $COMPANY , BOOL $MANDREL , BOOL $ALLARGATORE BOOL $MANUAL_ALLIGN , BOOL $SPINE_ALLIGN , STRING $WP_POZZETO) {
//Variables
	STRING $TOOLNUMBER = ""
	STRING $NAME = ""
	REAL $SPEED = 0
	REAL $FEED = 0
	REAL $PLUNGE = 0
	STRING LIST $TOOLPATHS = {}
	
	//List the Toolpaths
	IF $ALLARGATORE AND $MANUAL_ALLIGN {
		//SGR Procedure                Toolpath            Index  Tool
		//                              10        20        30
		//                     012345678901234567890123456789012345678
		STRING $DRILL       = "SPINE POZZETO D16 DRILL       2    T240"
		STRING $SMUSSO      = "SPINE POZZETO D16 SMUSSO      1    T369"
		$TOOLPATHS = {$DRILL , $SMUSSO}
		
		//Clear Toolpaths
		FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
			IF ENTITY_EXISTS('Toolpath' , $PATHNAME) {
				DELETE Toolpath $PATHNAME NOQUIBBLE
			}
		}
		
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D16\SPINE POZZETO D16 SGR.ptf"
	} ELSE {
		
		//FINtf Procedure              Toolpath            Index  Tool
		//                              10        20        30
		//                     012345678901234567890123456789012345678
		STRING $DRILL       = "SPINE POZZETO D16 DRILL       2    T238"
		STRING $PREFIN      = "SPINE POZZETO D16 PREFIN      2    T966"
		STRING $SMUSSO      = "SPINE POZZETO D16 SMUSSO      1    T806"
		STRING $SEMIFIN     = "SPINE POZZETO D16 SEMIFIN     2    T983"
		STRING $FIN         = "SPINE POZZETO D16 FIN         2    T983"
		$TOOLPATHS = {$DRILL , $PREFIN , $SMUSSO , $SEMIFIN , $FIN}
		
		//Clear Toolpaths
		FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
			IF ENTITY_EXISTS('Toolpath' , $PATHNAME) {
				DELETE Toolpath $PATHNAME NOQUIBBLE
			}
		}
		
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D16\SPINE POZZETO D16 FINTF.ptf"
	}
	
	//Select Solid to ignore it
	BLANK UNDO
	EDIT LEVEL "264" SELECT ALL
	
	//Build the toolpaths
	FOREACH PACKET IN $TOOLPATHS {
		STRING $PATHNAME = RTRIM(SUBSTRING($PACKET , 0 , 29))
		INT $INDEX = SUBSTRING($PACKET , 30 , 1)
		STRING $TOOLNUMBER = SUBSTRING($PACKET , 35 , 4)
		
		//Drill Toolpath
		ACTIVATE Toolpath $PATHNAME
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Select Component
		EDIT DRILL TOP_INDEX $INDEX
		EDIT DRILL COMP_INDEX $INDEX
		//Tool
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH THICKNESS LIST UPDATE 0 NEW
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D16_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D16_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D16_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D16_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH $PATHNAME CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
	}		
	//Deselect Solid
	BLANK UNDO
}