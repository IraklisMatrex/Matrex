//Mandrel and Allargatore
//Pozzeto side
//Toolpath Creation for Spine

	STRING $TOOLNUMBER = ""
	STRING $NAME = ""
	INT $SPEED = 0
	INT $FEED = 0
	INT $PLUNGE = 0
	
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 DRILL") {
		DELETE Toolpath "SPINE POZZETO D12 DRILL"
	}
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 SMUSSO") {
		DELETE Toolpath "SPINE POZZETO D12 SMUSSO"
	}
	
	//SGR and FINtf Procedures
	IF $ALLARGATORE AND $MANUAL_ALLIGN {
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\SPINE POZZETO D12 SGR.ptf"
		ACTIVATE Toolpath "SPINE POZZETO D12 DRILL"
		ACTIVATE WORKPLANE $WP_POZZETO
		$TOOLNUMBER = "T232"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT DRILL PECK_DEPTH $PLUNGE
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		BLANK UNDO
		[EDIT LEVEL "264" SELECT ALL
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		EDIT TOOLPATH "SPINE POZZETO D12 DRILL" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		ACTIVATE Toolpath "SPINE POZZETO D12 SMUSSO"
		ACTIVATE WORKPLANE $WP_POZZETO
		EDIT DRILL COMP_INDEX "1"
		$TOOLNUMBER = "T806"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		BLANK UNDO
		[EDIT LEVEL "264" SELECT ALL
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		EDIT TOOLPATH "SPINE POZZETO D12 SMUSSO" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
	} ELSE {
		
	}
}
FUNCTION SPINE_POZZETO_D12_TEMPLATE(STRING $SETNAME , STRING $COMPANY , BOOL $MANDREL , BOOL $ALLARGATORE BOOL $MANUAL_ALLIGN , BOOL $SPINE_ALLIGN , STRING $WP_POZZETO) {
	//Tool Variables
	STRING $TOOLNUMBER = ""
	STRING $NAME = ""
	INT $SPEED = 0
	INT $FEED = 0
	INT $PLUNGE = 0
	
	//Clear Toolpaths
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 DRILL") {
		DELETE Toolpath "SPINE POZZETO D12 DRILL"
	}
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 PREFIN") {
		DELETE Toolpath "SPINE POZZETO D12 DRILL"
	}
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 SMUSSO") {
		DELETE Toolpath "SPINE POZZETO D12 SMUSSO"
	}
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 SEMIFIN") {
		DELETE Toolpath "SPINE POZZETO D12 DRILL"
	}
	IF ENTITY_EXISTS('Toolpath',"SPINE POZZETO D12 FIN") {
		DELETE Toolpath "SPINE POZZETO D12 DRILL"
	}
	
	IF $ALLARGATORE AND $MANUAL_ALLIGN {
		//SGR Procedure
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D12\SPINE POZZETO D12 SGR.ptf"
		//Select Solid to ignore it
		BLANK UNDO
		EDIT LEVEL "264" SELECT ALL
		
		//Drill Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 DRILL"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Tool
		$TOOLNUMBER = "T232"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT DRILL PECK_DEPTH $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 DRILL" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Smusso Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 SMUSSO"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Select Component
		EDIT DRILL COMP_INDEX "1"
		//Tool
		$TOOLNUMBER = "T806"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 SMUSSO" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Deselect Solid
		BLANK UNDO
	} ELSE {
		//FINtf Procedure
		//Import all toolpaths
		IMPORT TEMPLATE PROJECT FILEOPEN "V:\Master Files\Matrex\Powermill\Tamplates\Pozzeto\Spine\D12\SPINE POZZETO D12 FINTF.ptf"
		//Select Solid to ignore it
		BLANK UNDO
		EDIT LEVEL "264" SELECT ALL
		
		//Drill Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 DRILL"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Tool
		$TOOLNUMBER = "T228"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT DRILL PECK_DEPTH $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 DRILL" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Prefin Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 PREFIN"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Tool
		$TOOLNUMBER = "T965"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT DRILL PECK_DEPTH $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 PREFIN" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Smusso Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 SMUSSO"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Select Component
		EDIT DRILL COMP_INDEX "1"
		//Tool
		$TOOLNUMBER = "T806"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 SMUSSO" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Semifin Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 SEMIFIN"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Tool
		$TOOLNUMBER = "T965"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT DRILL PECK_DEPTH $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 SEMIFIN" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
		
		//Fin Toolpath
		ACTIVATE Toolpath "SPINE POZZETO D12 FIN"
		//Workplane
		ACTIVATE WORKPLANE $WP_POZZETO
		//Tool
		$TOOLNUMBER = "T965"
		IF $COMPANY == "Matrex" {
			CALL $MatrexToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSEIF $COMPANY == "Alumat" {
			CALL $AlumatToolsForDrilling($TOOLNUMBER , $NAME , $SPEED , $FEED , $PLUNGE)
		} ELSE {
			MESSAGE ERROR "Uknown Company"
		}
		ACTIVATE TOOL $NAME
		EDIT RPM $SPEED
		EDIT FRATE $FEED
		EDIT PRATE $PLUNGE
		EDIT DRILL PECK_DEPTH $PLUNGE
		//Rapids
		EDIT TOOLPATH SAFEAREA SIZE "2"
		EDIT TOOLPATH SAFEAREA PLUNGE_SIZE  "2"
		//Component Thickness
		EDIT TOOLPATH ; THICKNESS ACQUIRE
		EDIT TOOLPATH ; THICKNESS COMPONENTS IGNORE
		//Select Featureset Components
		ACTIVATE Featureset $SETNAME
		DIALOGS MESSAGE OFF
		DIALOGS ERROR OFF
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_1"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_2"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_3"
		EDIT FEATURESET $SETNAME SELECT "SPINE_POZZETO_D12_4"
		DIALOGS MESSAGE ON
		DIALOGS ERROR ON
		//Calculate
		EDIT TOOLPATH "SPINE POZZETO D12 FIN" CALCULATE
		DEACTIVATE Toolpath
		DEACTIVATE Tool
		DEACTIVATE Featureset
	}
}
